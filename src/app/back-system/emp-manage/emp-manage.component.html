<p-toolbar class="mb-2">
  <div class="p-toolbar-group-left">
    <!-- æ–°å¢å“¡å·¥æŒ‰éˆ• -->
    <button
      pButton
      type="button"
      icon="pi pi-plus"
      label="æ–°å¢å“¡å·¥"
      class="p-button-success mr-2 rounded"
      (click)="showCreateDialog()"
    ></button>

    <!-- æ‰¹æ¬¡åˆŠé™¤æŒ‰éˆ•ï¼Œåªæœ‰ç•¶å·²é¸æ“‡ selectedEmps é•·åº¦ > 0 æ‰å¯é»æ“Š -->
    <button
      pButton
      type="button"
      icon="pi pi-trash"
      label="åˆªé™¤é¸å–"
      class="p-button-danger rounded"
      [disabled]="!selectedEmps || selectedEmps.length === 0"
      (click)="confirmDeleteSelected()"
    ></button>
  </div>
</p-toolbar>

<div class="card table-container">
  <p-table
    #dt1
    [value]="empList"
    [lazy]="true"
    (onLazyLoad)="loadLazyData($event)"
    [paginator]="true"
    [rows]="10"
    [totalRecords]="totalRecords"
    [loading]="loading"
    [first]="first"
    selectionMode="multiple"
    [(selection)]="selectedEmps"
    dataKey="userID"
    [tableStyle]="{ 'min-width': '50rem' }"
    stateStorage="session"
    stateKey="emp-session"
  >
    <!-- ğŸ”¹ è¡¨é ­å€ï¼šå…ˆåŠ ä¸Š checkbox æ¬„ä½ï¼Œå†åŠ æ¬„ä½æ’åºèˆ‡ç¯©é¸ -->
    <ng-template pTemplate="header">
      <tr>
        <!-- 1-1. å¤šé¸ CheckBox æ¬„ä½ -->
        <th style="width: 3rem">
          <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
        </th>

        <!-- 1-2. å…¶ä»–æ¬„ä½ï¼šå§“å/ä¿¡ç®±/éƒ¨é–€/ç‹€æ…‹/æ“ä½œ -->
        <th pSortableColumn="username" style="width: 20%">
          å“¡å·¥å§“å <p-sortIcon field="username"></p-sortIcon>
        </th>
        <th pSortableColumn="email" style="width: 20%">
          å“¡å·¥ä¿¡ç®± <p-sortIcon field="email"></p-sortIcon>
        </th>
        <th pSortableColumn="department" style="width: 20%">
          æ‰€å±¬éƒ¨é–€ <p-sortIcon field="department"></p-sortIcon>
        </th>
        <th pSortableColumn="statusLabel" style="width: 15%">
          å¸³è™Ÿç‹€æ…‹ <p-sortIcon field="statusLabel"></p-sortIcon>
        </th>
        <th style="width: 10%">æ“ä½œ</th>
      </tr>
      <tr>
        <!-- 1-3. ç¯©é¸åˆ—ï¼šå¤šé¸æ¬„ä½é€™è£¡ç•™ç©º -->
        <th></th>

        <th>
          <input
            pInputText
            type="text"
            (input)="onInputFilter($event, 'username', dt1)"
            [value]="getFilterValue(dt1.filters['username'])"
            placeholder="Search Name"
            class="w-full custom-input"
          />
        </th>
        <th>
          <input
            pInputText
            type="text"
            (input)="onInputFilter($event, 'email', dt1)"
            [value]="getFilterValue(dt1.filters['email'])"
            placeholder="Search Email"
            class="w-full custom-input"
          />
        </th>
        <th>
          <input
            pInputText
            type="text"
            (input)="onInputFilter($event, 'department', dt1)"
            [value]="getFilterValue(dt1.filters['department'])"
            placeholder="Search Department"
            class="w-full custom-input"
          />
        </th>
        <th>
          <input
            pInputText
            type="text"
            (input)="onInputFilter($event, 'statusLabel', dt1)"
            [value]="getFilterValue(dt1.filters['statusLabel'])"
            placeholder="Search Status"
            class="w-full custom-input"
          />
        </th>
        <!-- ç¯©é¸åˆ—æœ€å¾Œä¸€æ ¼ï¼ˆæ“ä½œï¼‰çš„æ ¼å­ç•™ç©º -->
        <th></th>
      </tr>
    </ng-template>

    <!-- ğŸ”¸ è³‡æ–™åˆ—ï¼šå…ˆé¡¯ç¤º checkboxï¼Œå†é¡¯ç¤ºå…¶ä»–æ¬„ä½ã€æœ€å¾Œä¸€æ¬„é¡¯ç¤ºã€Œåˆªé™¤åœ–ç¤ºã€-->
    <ng-template pTemplate="body" let-emp>
      <tr [pSelectableRow]="emp">
        <!-- 2-1. å¤šé¸ CheckBox -->
        <td>
          <p-tableCheckbox [value]="emp"></p-tableCheckbox>
        </td>

        <!-- 2-2. å…¶ä»–æ¬„ä½ï¼šéƒ½æ”¹æˆ emp?.xxx -->
        <td>{{ emp?.username }}</td>
        <td>{{ emp?.email }}</td>
        <td>{{ emp?.department }}</td>
        <td>
          <p-tag
            [value]="emp?.statusLabel"
            [severity]="emp?.isEmailConfirmed ? 'success' : 'warning'"
          ></p-tag>
        </td>

        <!-- 2-3. å–®ç­†åˆªé™¤æŒ‰éˆ• -->
        <td>
          <button
            pButton
            type="button"
            icon="pi pi-trash"
            class="p-button-rounded p-button-text p-button-danger"
            (click)="confirmDelete(emp)"
          ></button>
        </td>
      </tr>
    </ng-template>

    <!-- â›” ç©ºè³‡æ–™é¡¯ç¤º -->
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="6">No employee found.</td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!-- 3. æ–°å¢/ç·¨è¼¯ Dialogï¼ˆä»¥ã€Œæ–°å¢å“¡å·¥ã€ç‚ºä¾‹ï¼Œå¯è¤‡ç”¨åŒä¸€å€‹ Dialog ä¾†åšç·¨è¼¯ï¼‰ -->
<p-dialog
  header="{{ isCreateMode ? 'æ–°å¢å“¡å·¥' : 'ç·¨è¼¯å“¡å·¥' }}"
  [(visible)]="displayEmpDialog"
  [modal]="true"
  [style]="{ width: '400px' }"
  [closable]="false"
  (onHide)="onDialogHide()"
>
  <div class="p-fluid">
    <!-- å‡è¨­å“¡å·¥ç‰©ä»¶å±¬æ€§æœ‰ï¼šusernameã€emailã€departmentã€isEmailConfirmed -->
    <div class="p-field">
      <label for="username">å“¡å·¥å§“å</label>
      <input
        id="username"
        type="text"
        pInputText
        [(ngModel)]="currentEmp.username"
        required
      />
    </div>

    <div class="p-field">
      <label for="email">é›»å­éƒµä»¶</label>
      <input
        id="email"
        type="email"
        pInputText
        [(ngModel)]="currentEmp.email"
        required
      />
    </div>

    <div class="p-field">
      <label for="department">éƒ¨é–€</label>
      <input
        id="department"
        type="text"
        pInputText
        [(ngModel)]="currentEmp.department"
      />
    </div>

    <div class="p-field-checkbox">
      <p-checkbox
        inputId="activeStatus"
        [(ngModel)]="currentEmp.isEmailConfirmed"
        [binary]="true"
      ></p-checkbox>
      <label for="activeStatus">æ˜¯å¦å•Ÿç”¨ (Email å·²é©—è­‰)</label>
    </div>
  </div>

  <p-footer>
    <button
      pButton
      type="button"
      label="å–æ¶ˆ"
      icon="pi pi-times"
      class="p-button-text"
      (click)="displayEmpDialog = false"
    ></button>
    <button
      pButton
      type="button"
      label="å„²å­˜"
      icon="pi pi-check"
      class="p-button-success"
      (click)="saveEmployee()"
      [disabled]="!currentEmp.username || !currentEmp.email"
    ></button>
  </p-footer>
</p-dialog>

<!-- 4. ç¢ºèªåˆªé™¤ (ConfirmDialog) -->
<p-confirmDialog></p-confirmDialog>
