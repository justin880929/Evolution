<div class="container">
  <div class="row">
    <!-- Â∑¶ÂÅ¥ÔºöÂ¶ÇÊûúË≥ºÁâ©ËªäÊúâÈ†ÖÁõÆÔºåÈ°ØÁ§∫ÂàóË°®ÔºõÂê¶ÂâáÈ°ØÁ§∫Á©∫ÁãÄÊÖã -->
    <div class="col-9">
      <!-- Â¶ÇÊûú cartItems.length > 0ÔºåÊâçÈ°ØÁ§∫ÂéüÊú¨ÁöÑË≥ºÁâ©ËªäÂàóË°® -->
      <ng-container *ngIf="cartItems.length > 0; else emptyCart">
        <div class="card">
          <!-- 1. Toast È°ØÁ§∫‰ΩçÁΩÆ -->
          <p-toast></p-toast>

          <!-- 2. Â∑•ÂÖ∑ÂàóÔºöÂà™Èô§Â∑≤ÈÅ∏È†ÖÁõÆ -->
          <p-toolbar styleClass="gap-2">
            <ng-template pTemplate="left">
              <button
                pButton
                pRipple
                label="Delete"
                icon="pi pi-trash"
                class="p-button-danger mr-2 rounded"
                (click)="deleteSelectedItems()"
                [disabled]="!selectedItems || !selectedItems.length"
              ></button>
            </ng-template>
          </p-toolbar>

          <!-- 3. PrimeNG Table -->
          <p-table
            #dt
            [value]="cartItems"
            [(selection)]="selectedItems"
            dataKey="id"
            [rowHover]="true"
            [globalFilterFields]="['title', 'price']"
            [tableStyle]="{ 'min-width': '40rem' }"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} items"
            [showCurrentPageReport]="true"
          >
            <!-- 3.1 CaptionÔºöÊ®ôÈ°å + ÂÖ®ÂüüÊêúÂ∞ã -->
            <ng-template pTemplate="caption">
              <div class="flex align-items-center justify-content-between">
                <h5 class="m-0">üõí Ë≥ºÁâ©Ëªä</h5>
                <span class="p-input-icon-left">
                  <i class="pi pi-search"></i>
                  <input
                    pInputText
                    type="text"
                    (input)="
                      dt.filterGlobal($any($event.target).value, 'contains')
                    "
                    placeholder="ÊêúÂ∞ãË™≤Á®ã..."
                  />
                </span>
              </div>
            </ng-template>

            <!-- 3.2 HeaderÔºöÊñ∞Â¢û„ÄåÁÖßÁâá„ÄçÊ¨Ñ‰ΩçÁÇ∫Á¨¨‰∏ÄÂÄã -->
            <ng-template pTemplate="header">
              <tr>
                <th style="width: 4rem">
                  <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                </th>
                <!-- ÁÖßÁâáÊ¨Ñ‰Ωç -->
                <th style="width: 6rem">ÁÖßÁâá</th>
                <!-- Ë™≤Á®ãÂêçÁ®± -->
                <th pSortableColumn="title" style="min-width: 15rem">
                  Ë™≤Á®ãÂêçÁ®±
                  <p-sortIcon field="title"></p-sortIcon>
                </th>
                <!-- ÂÉπÊ†º -->
                <th pSortableColumn="price">
                  ÂÉπÊ†º
                  <p-sortIcon field="price"></p-sortIcon>
                </th>
                <!-- Êìç‰Ωú -->
                <th style="width: 8rem">Êìç‰Ωú</th>
              </tr>
            </ng-template>

            <!-- 3.3 BodyÔºöÊØèÂàóÂÖàÈ°ØÁ§∫ÁÖßÁâá„ÄÅÂÜçÈ°ØÁ§∫ÂêçÁ®±„ÄÅÂÉπÊ†º„ÄÅÊúÄÂæåÊìç‰ΩúÊåâÈàï -->
            <ng-template pTemplate="body" let-item>
              <tr>
                <!-- ÂãæÈÅ∏Ê°Ü -->
                <td>
                  <p-tableCheckbox [value]="item"></p-tableCheckbox>
                </td>
                <!-- ÁÖßÁâáÊ¨Ñ‰Ωç -->
                <td>
                  <img
                    [src]="item.coverImage"
                    alt="{{ item.title }} ÂúñÁâá"
                    style="
                      width: 50px;
                      height: 50px;
                      object-fit: cover;
                      border-radius: 0.25rem;
                    "
                    (error)="item.coverImage = 'assets/img/course-product.png'"
                  />
                </td>
                <!-- Ë™≤Á®ãÂêçÁ®± -->
                <td>{{ item.title }}</td>
                <!-- ÂÉπÊ†º -->
                <td>NT$ {{ item.price }}</td>
                <!-- Êìç‰ΩúÊåâÈàï -->
                <td>
                  <button
                    type="button"
                    class="btn btn-outline-danger btn-sm rounded-circle"
                    (click)="deleteItem(item)"
                  >
                    <i class="bi bi-trash"></i>
                  </button>
                </td>
              </tr>
            </ng-template>

            <!-- ‚Üì ÁßªÈô§ p-template="summary" ‚Üì -->
          </p-table>
        </div>

        <!-- Á¢∫Ë™çÂ∞çË©±Ê°Ü -->
        <p-confirmDialog [style]="{ width: '450px' }"></p-confirmDialog>
      </ng-container>

      <!-- Á©∫ÁãÄÊÖãÁØÑÊú¨ -->
      <ng-template #emptyCart>
        <div class="card text-center p-5">
          <div class="card-body">
            <p class="h5 mb-4">Ë≥ºÁâ©ËªäÊòØÁ©∫ÁöÑÔºåÂÜçÂéªÂ∞ãÊâæÈÄ≤Âåñ‰πãË∑ØÂêß !</p>
            <button
              class="btn btn-evolution"
              type="button"
              [routerLink]="['/home/course-products']"
            >
              ÂâçÂæÄÂïÜÂìÅÈ†Å
            </button>
          </div>
        </div>
      </ng-template>
    </div>

    <!-- Âè≥ÂÅ¥ÔºöÂè™ÊúâÂú®Ë≥ºÁâ©ËªäÊúâÈ†ÖÁõÆÊôÇÊâçÈ°ØÁ§∫Ë®ÇÂñÆÊòéÁ¥∞ -->
    <div class="col-3" *ngIf="cartItems.length > 0">
      <div class="border rounded p-3 text-center">
        <!-- 1. ÊèíÂÖ•ÂúñÁâáÔºöË´ãÂ∞á src ÊèõÊàê‰Ω†ÂØ¶ÈöõÂÑ≤Â≠òÁöÑË∑ØÂæë -->
        <img
          src="assets/img/transaction.png"
          alt="Evolution ‰∫§Êòì ÊèíÂúñ"
          class="img-fluid w-100 mb-3"
        />

        <!-- 2. Ë®ÇÂñÆÊòéÁ¥∞Ê®ôÈ°å -->
        <h5 class="mb-3">Ë®ÇÂñÆÊòéÁ¥∞</h5>

        <!-- 3. È°ØÁ§∫„ÄåÂ∑≤ÈÅ∏Âèñ‰ª∂Êï∏„ÄçËàá„ÄåÂ∑≤ÈÅ∏ÂèñÂïÜÂìÅÂêà‰ΩµÁ∏ΩÂÉπ„Äç -->
        <div class="d-flex justify-content-between mb-2">
          <span>{{ selectedItems.length || 0 }} ‰ª∂Â∞èË®à</span>
          <span>NT$ {{ getSelectedTotal() }}</span>
        </div>

        <hr />

        <!-- 4. Á∏ΩÈáëÈ°ç -->
        <div class="d-flex justify-content-between align-items-center mb-3">
          <strong>Á∏ΩÈáëÈ°ç</strong>
          <strong>NT$ {{ getSelectedTotal() }}</strong>
        </div>

        <!-- 5. ÁµêÂ∏≥ÊåâÈàïÔºöÊ≤íÊúâÂãæÈÅ∏‰ªª‰ΩïÈ†ÖÁõÆÂ∞± disable -->
        <button
          class="btn btn-evolution w-100"
          type="button"
          (click)="checkout()"
          [disabled]="!selectedItems.length"
        >
          ‰æÜÂéªÁµêÂ∏≥
        </button>
      </div>
    </div>
  </div>
</div>
